/*!
 * AjaxUpload - Upload button for uploading multiple files with progress-bar
 * Version: 1.5.0
 * Build date: 2016-06-22
 */

!function(a,b,c,d){function e(b,c){this.options=a.extend({},g,c),this._defaults=g,this._name=f,this.$el=a(b),this.count=0,this.init()}var f="ajaxUpload",g={debug:!1,uploadAction:"",uid:"",dragText:"Drop files here to upload",uploadButtonText:"Upload a file",cancelButtonText:"Cancel",failUploadText:"Upload failed",deleteText:"Delete a file",clearText:"Delete all files",hideShowDropArea:!0,thumbX:"100",thumbY:"100",allowedExtensions:[],sizeLimit:0,maxFiles:3,messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."}};e.prototype={init:function(){var b=this,c=a(".file-uploader-items",b.$el);b.count=c.children().length;new qq.FileUploader({element:a(".file-uploader-buttons",b.$el)[0],action:b.options.uploadAction,params:{uid:b.options.uid,action:"web/upload"},dragText:b.options.dragText,uploadButtonText:b.options.uploadButtonText,cancelButtonText:b.options.cancelButtonText,failUploadText:b.options.failUploadText,hideShowDropArea:!0,allowedExtensions:b.options.allowedExtensions,sizeLimit:b.options.sizeLimit,maxConnections:this.options.maxConnections,messages:b.options.messages,onComplete:function(d,e,f){var g=f.fileid;if(f.success){var h=a("<div>").addClass("file-wrap").data("fileid",g),i=a("<div>").addClass("delete-button").html(b.options.deleteText).click(function(){b.remove(h,g)}),j=a("<input>").attr({name:b.options.uid+"_fileid[]",value:g,type:"hidden"}),k=a("<img>").attr({src:f.filename}).css({position:"relative"});b.options.thumbX>0&&k.css("width",b.options.thumbX+"px"),b.options.thumbY>0&&k.css("height",b.options.thumbY+"px"),c.append(h.append(j,k,i)),a(".qq-upload-list li",b.$el).eq(d).hide(),b.options.debug&&alert("ID:"+d+"\nResponse:"+JSON.stringify(f))}}});a(".file-uploader-items .file-wrap .delete-button",b.$el).click(function(){var c=a(this).parent(),d=c.data("fileid");b.remove(c,d)});var d=a("<div>").addClass("qq-clear-button").html(b.options.clearText).click(function(){b.clear()});b.options.maxFiles>1&&a(".qq-upload-button",b.$el).after(d).after(" ")},remove:function(b,c){var d=this;a.get(d.options.uploadAction,{"delete":c,uid:d.options.uid,action:"web/upload"},function(e){e.success&&(b.fadeOut(function(){a(this).remove()}),d.options.debug&&alert(JSON.stringify(e)+"\nFile "+c+" deleted."))},"json")},clear:function(){var b=this;a.get(b.options.uploadAction,{"delete":"all",uid:b.options.uid,action:"web/upload"},function(c){c.success&&(a(".file-uploader-items",b.$el).empty(),a(".qq-upload-list li",b.$el).remove(),b.options.debug&&alert(JSON.stringify(c)+"\nAll Items deleted."))},"json")}},a.fn[f]=function(b){var c=arguments;if(b===d||"object"==typeof b)return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))});if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var g;return this.each(function(){var d=a.data(this,"plugin_"+f);d instanceof e&&"function"==typeof d[b]&&(g=d[b].apply(d,Array.prototype.slice.call(c,1))),"destroy"===b&&a.data(this,"plugin_"+f,null)}),g!==d?g:this}}}(jQuery,window,document);var qq=qq||{};qq.extend=function(a,b){for(var c in b)a[c]=b[c]},qq.indexOf=function(a,b,c){if(a.indexOf)return a.indexOf(b,c);c=c||0;var d=a.length;for(0>c&&(c+=d);d>c;c++)if(c in a&&a[c]===b)return c;return-1},qq.getUniqueId=function(){var a=0;return function(){return a++}}(),qq.ie=function(){return-1!=navigator.userAgent.indexOf("MSIE")},qq.safari=function(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Google")},qq.firefox=function(){return-1!=navigator.userAgent.indexOf("Mozilla")&&void 0!=navigator.vendor&&""==navigator.vendor},qq.windows=function(){return"Win32"==navigator.platform},qq.attach=function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c),function(){qq.detach(a,b,c)}},qq.detach=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.attachEvent&&a.detachEvent("on"+b,c)},qq.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},qq.insertBefore=function(a,b){b.parentNode.insertBefore(a,b)},qq.remove=function(a){a.parentNode.removeChild(a)},qq.contains=function(a,b){return a==b?!0:a.contains?a.contains(b):!!(8&b.compareDocumentPosition(a))},qq.toElement=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;var c=a.firstChild;return a.removeChild(c),c}}(),qq.css=function(a,b){null!=b.opacity&&"string"!=typeof a.style.opacity&&"undefined"!=typeof a.filters&&(b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"),qq.extend(a.style,b)},qq.hasClass=function(a,b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className)},qq.addClass=function(a,b){qq.hasClass(a,b)||(a.className+=" "+b)},qq.removeClass=function(a,b){var c=new RegExp("(^| )"+b+"( |$)");a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,"")},qq.setText=function(a,b){a.innerText=b,a.textContent=b},qq.children=function(a){for(var b=[],c=a.firstChild;c;)1==c.nodeType&&b.push(c),c=c.nextSibling;return b},qq.getByClass=function(a,b){if(a.querySelectorAll)return a.querySelectorAll("."+b);for(var c=[],d=a.getElementsByTagName("*"),e=d.length,f=0;e>f;f++)qq.hasClass(d[f],b)&&c.push(d[f]);return c},qq.obj2url=function(a,b,c){var d=[],e="&",f=function(a,c){var e=b?/\[\]$/.test(b)?b:b+"["+c+"]":c;"undefined"!=e&&"undefined"!=c&&d.push("object"==typeof a?qq.obj2url(a,e,!0):"[object Function]"===Object.prototype.toString.call(a)?encodeURIComponent(e)+"="+encodeURIComponent(a()):encodeURIComponent(e)+"="+encodeURIComponent(a))};if(!c&&b)e=/\?/.test(b)?/\?$/.test(b)?"":"&":"?",d.push(b),d.push(qq.obj2url(a));else if("[object Array]"===Object.prototype.toString.call(a)&&"undefined"!=typeof a)for(var g=0,h=a.length;h>g;++g)f(a[g],g);else if("undefined"!=typeof a&&null!==a&&"object"==typeof a)for(var g in a)f(a[g],g);else d.push(encodeURIComponent(b)+"="+encodeURIComponent(a));return d.join(e).replace(/^&/,"").replace(/%20/g,"+")};var qq=qq||{};qq.FileUploaderBasic=function(a){this._options={debug:!1,action:"/server/upload",params:{},customHeaders:{},button:null,multiple:!0,maxConnections:3,allowedExtensions:[],acceptFiles:null,sizeLimit:0,minSizeLimit:0,abortOnFailure:!0,onSubmit:function(a,b){},onProgress:function(a,b,c,d){},onComplete:function(a,b,c){},onCancel:function(a,b){},onUpload:function(a,b,c){},onError:function(a,b,c){},messages:{typeError:"Unfortunately the file(s) you selected weren't the type we were expecting. Only {extensions} files are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(a){alert(a)},inputName:"qqfile",extraDropzones:[]},qq.extend(this._options,a),qq.extend(this,qq.DisposeSupport),this._filesInProgress=0,this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},qq.FileUploaderBasic.prototype={setParams:function(a){this._options.params=a},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(a){var b=this,c=new qq.UploadButton({element:a,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),acceptFiles:this._options.acceptFiles,onChange:function(a){b._onInputChange(a)}});return this.addDisposer(function(){c.dispose()}),c},_createUploadHandler:function(){var a,b,c=this;return a=qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm",b=new qq[a]({debug:this._options.debug,action:this._options.action,encoding:this._options.encoding,maxConnections:this._options.maxConnections,customHeaders:this._options.customHeaders,inputName:this._options.inputName,extraDropzones:this._options.extraDropzones,onProgress:function(a,b,d,e){c._onProgress(a,b,d,e),c._options.onProgress(a,b,d,e)},onComplete:function(a,b,d){c._onComplete(a,b,d),c._options.onComplete(a,b,d)},onCancel:function(a,b){c._onCancel(a,b),c._options.onCancel(a,b)},onError:c._options.onError,onUpload:function(a,b,d){c._onUpload(a,b,d),c._options.onUpload(a,b,d)}})},_preventLeaveInProgress:function(){var a=this;this._attach(window,"beforeunload",function(b){if(a._filesInProgress){var b=b||window.event;return b.returnValue=a._options.messages.onLeave,a._options.messages.onLeave}})},_onSubmit:function(){this._filesInProgress++},_onProgress:function(a,b,c,d){},_onComplete:function(a,b,c){this._filesInProgress--,c.error&&this._options.showMessage(c.error)},_onCancel:function(){this._filesInProgress--},_onUpload:function(a,b,c){},_onInputChange:function(a){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList(a.files):this._validateFile(a)&&this._uploadFile(a),this._button.reset()},_uploadFileList:function(a){for(var b=[],c=0;c<a.length;c++)if(this._validateFile(a[c]))b.push(a[c]);else if(this._options.abortOnFailure)return;for(var c=0;c<b.length;c++)this._uploadFile(b[c])},_uploadFile:function(a){var b=this._handler.add(a),c=this._handler.getName(b);this._options.onSubmit(b,c)!==!1&&(this._onSubmit(b,c),this._handler.upload(b,this._options.params))},_validateFile:function(a){var b,c;return a.value?b=a.value.replace(/.*(\/|\\)/,""):(b=null!==a.fileName&&void 0!==a.fileName?a.fileName:a.name,c=null!==a.fileSize&&void 0!==a.fileSize?a.fileSize:a.size),this._isAllowedExtension(b)?0===c?(this._error("emptyError",b),!1):c&&this._options.sizeLimit&&c>this._options.sizeLimit?(this._error("sizeError",b),!1):c&&c<this._options.minSizeLimit?(this._error("minSizeError",b),!1):!0:(this._error("typeError",b),!1)},_error:function(a,b){function c(a,b){d=d.replace(a,b)}var d=this._options.messages[a];c("{file}",this._formatFileName(b)),c("{extensions}",this._options.allowedExtensions.join(", ")),c("{sizeLimit}",this._formatSize(this._options.sizeLimit)),c("{minSizeLimit}",this._formatSize(this._options.minSizeLimit)),this._options.showMessage(d)},_formatFileName:function(a){return a.length>33&&(a=a.slice(0,19)+"..."+a.slice(-13)),a},_isAllowedExtension:function(a){var b=-1!==a.indexOf(".")?a.replace(/.*[.]/,"").toLowerCase():"",c=this._options.allowedExtensions;if(!c.length)return!0;for(var d=0;d<c.length;d++)if(c[d].toLowerCase()==b)return!0;return!1},_formatSize:function(a){var b=-1;do a/=1024,b++;while(a>99);return Math.max(a,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]}},qq.FileUploader=function(a){qq.FileUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,dragText:"Drop files here to upload",uploadButtonText:"Upload a file",cancelButtonText:"Cancel",failUploadText:"Upload failed",hideShowDropArea:!0,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>{dragText}</span></div><div class="qq-upload-button">{uploadButtonText}</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-progress-bar"></span><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><span class="qq-upload-failed-text">{failUploadtext}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}}),qq.extend(this._options,a),this._options.template=this._options.template.replace(/\{dragText\}/g,this._options.dragText),this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.uploadButtonText),this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.cancelButtonText),this._options.fileTemplate=this._options.fileTemplate.replace(/\{failUploadtext\}/g,this._options.failUploadText),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button=this._createUploadButton(this._find(this._element,"button")),this._bindCancelEvent(),this._setupDragDrop()},qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype),qq.extend(qq.FileUploader.prototype,{addExtraDropzone:function(a){this._setupExtraDropzone(a)},removeExtraDropzone:function(a){var b=this._options.extraDropzones;for(var c in b)if(b[c]===a)return this._options.extraDropzones.splice(c,1)},_leaving_document_out:function(a){return(qq.chrome()||qq.safari()&&qq.windows())&&0==a.clientX&&0==a.clientY||qq.firefox()&&!a.relatedTarget},_find:function(a,b){var c=qq.getByClass(a,this._options.classes[b])[0];if(!c)throw new Error("element not found "+b);return c},_setupExtraDropzone:function(a){this._options.extraDropzones.push(a),this._setupDropzone(a)},_setupDropzone:function(a){var b=this,c=new qq.UploadDropZone({element:a,onEnter:function(c){qq.addClass(a,b._classes.dropActive),c.stopPropagation()},onLeave:function(a){},onLeaveNotDescendants:function(){qq.removeClass(a,b._classes.dropActive)},onDrop:function(c){b._options.hideShowDropArea&&(a.style.display="none"),qq.removeClass(a,b._classes.dropActive),b._uploadFileList(c.dataTransfer.files)}});this.addDisposer(function(){c.dispose()}),this._options.hideShowDropArea&&(a.style.display="none")},_setupDragDrop:function(){var a=this._find(this._element,"drop"),b=this;this._options.extraDropzones.push(a);var c,d=this._options.extraDropzones;for(c=0;c<d.length;c++)this._setupDropzone(d[c]);qq.ie()||this._attach(document,"dragenter",function(e){if(b._isValidFileDrag(e)&&!qq.hasClass(a,b._classes.dropDisabled))for(a.style.display="block",c=0;c<d.length;c++)d[c].style.display="block"}),this._attach(document,"dragleave",function(a){document.elementFromPoint(a.clientX,a.clientY);if(b._options.hideShowDropArea&&qq.FileUploader.prototype._leaving_document_out(a))for(c=0;c<d.length;c++)d[c].style.display="none"}),qq.attach(document,"drop",function(a){if(b._options.hideShowDropArea)for(c=0;c<d.length;c++)d[c].style.display="none";a.preventDefault()})},_onSubmit:function(a,b){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(a,b)},_onProgress:function(a,b,c,d){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var e=this._getItemByFileId(a),f=this._find(e,"size");f.style.display="inline";var g,h=Math.round(c/d*100);g=c!=d?h+"% from "+this._formatSize(d):this._formatSize(d),this._find(e,"progressBar").style.width=h+"%",qq.setText(f,g)},_onComplete:function(a,b,c){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var d=this._getItemByFileId(a);qq.remove(this._find(d,"cancel")),qq.remove(this._find(d,"spinner")),c.success?qq.addClass(d,this._classes.success):qq.addClass(d,this._classes.fail)},_addToList:function(a,b){var c=qq.toElement(this._options.fileTemplate);c.qqFileId=a;var d=this._find(c,"file");qq.setText(d,this._formatFileName(b)),this._find(c,"size").style.display="none",this._options.multiple||this._clearList(),this._listElement.appendChild(c)},_clearList:function(){this._listElement.innerHTML=""},_getItemByFileId:function(a){for(var b=this._listElement.firstChild;b;){if(b.qqFileId==a)return b;b=b.nextSibling}},_bindCancelEvent:function(){var a=this,b=this._listElement;this._attach(b,"click",function(b){b=b||window.event;var c=b.target||b.srcElement;if(qq.hasClass(c,a._classes.cancel)){qq.preventDefault(b);var d=c.parentNode;a._handler.cancel(d.qqFileId),qq.remove(d)}})}}),qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(a){},onLeave:function(a){},onLeaveNotDescendants:function(a){},onDrop:function(a){}},qq.extend(this._options,a),qq.extend(this,qq.DisposeSupport),this._element=this._options.element,this._disableDropOutside(),this._attachEvents()},qq.UploadDropZone.prototype={_dragover_should_be_canceled:function(){return qq.safari()||qq.firefox()&&qq.windows()},_disableDropOutside:function(){qq.UploadDropZone.dropOutsideDisabled||(this._dragover_should_be_canceled?qq.attach(document,"dragover",function(a){a.preventDefault()}):qq.attach(document,"dragover",function(a){a.dataTransfer&&(a.dataTransfer.dropEffect="none",a.preventDefault())}),qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var a=this;a._attach(a._element,"dragover",function(b){if(a._isValidFileDrag(b)){var c=qq.ie()?null:b.dataTransfer.effectAllowed;"move"==c||"linkMove"==c?b.dataTransfer.dropEffect="move":b.dataTransfer.dropEffect="copy",b.stopPropagation(),b.preventDefault()}}),a._attach(a._element,"dragenter",function(b){a._isValidFileDrag(b)&&a._options.onEnter(b)}),a._attach(a._element,"dragleave",function(b){if(a._isValidFileDrag(b)){a._options.onLeave(b);var c=document.elementFromPoint(b.clientX,b.clientY);qq.contains(this,c)||a._options.onLeaveNotDescendants(b)}}),a._attach(a._element,"drop",function(b){a._isValidFileDrag(b)&&(b.preventDefault(),a._options.onDrop(b))})},_isValidFileDrag:function(a){if(qq.ie())return!1;var b=a.dataTransfer,c=qq.safari();return b&&"none"!=b.effectAllowed&&(b.files||!c&&b.types.contains&&b.types.contains("Files"))}},qq.UploadButton=function(a){this._options={element:null,multiple:!1,acceptFiles:null,name:"file",onChange:function(a){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},qq.extend(this._options,a),qq.extend(this,qq.DisposeSupport),this._element=this._options.element,qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq.remove(this._input),qq.removeClass(this._element,this._options.focusClass),this._input=this._createInput()},_createInput:function(){var a=document.createElement("input");this._options.multiple&&a.setAttribute("multiple","multiple"),this._options.acceptFiles&&a.setAttribute("accept",this._options.acceptFiles),a.setAttribute("type","file"),a.setAttribute("name",this._options.name),qq.css(a,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(a);var b=this;return this._attach(a,"change",function(){b._options.onChange(a)}),this._attach(a,"mouseover",function(){qq.addClass(b._element,b._options.hoverClass)}),this._attach(a,"mouseout",function(){qq.removeClass(b._element,b._options.hoverClass)}),this._attach(a,"focus",function(){qq.addClass(b._element,b._options.focusClass)}),this._attach(a,"blur",function(){qq.removeClass(b._element,b._options.focusClass)}),window.attachEvent&&a.setAttribute("tabIndex","-1"),a}},qq.UploadHandlerAbstract=function(a){this._options={debug:!1,action:"/upload.php",maxConnections:999,onProgress:function(a,b,c,d){},onComplete:function(a,b,c){},onCancel:function(a,b){},onUpload:function(a,b,c){}},qq.extend(this._options,a),this._queue=[],this._params=[]},qq.UploadHandlerAbstract.prototype={log:function(a){this._options.debug&&window.console&&console.log("[uploader] "+a)},add:function(a){},upload:function(a,b){var c=this._queue.push(a),d={};qq.extend(d,b),this._params[a]=d,c<=this._options.maxConnections&&this._upload(a,this._params[a])},cancel:function(a){this._cancel(a),this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++)this._cancel(this._queue[a]);this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},_upload:function(a){},_cancel:function(a){},_dequeue:function(a){var b=qq.indexOf(this._queue,a);this._queue.splice(b,1);var c=this._options.maxConnections;if(this._queue.length>=c&&c>b){var d=this._queue[c-1];this._upload(d,this._params[d])}}},qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={}},qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name",this._options.inputName);var b="qq-upload-handler-iframe"+qq.getUniqueId();return this._inputs[b]=a,a.parentNode&&qq.remove(a),b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_cancel:function(a){this._options.onCancel(a,this.getName(a)),delete this._inputs[a];var b=document.getElementById(a);b&&(b.setAttribute("src","javascript:false;"),qq.remove(b))},_upload:function(a,b){this._options.onUpload(a,this.getName(a),!1);var c=this._inputs[a];if(!c)throw new Error("file with passed id was not added, or already uploaded or cancelled");var d=this.getName(a),e=this._createIframe(a),f=this._createForm(e,b);f.appendChild(c);var g=this;return this._attachLoadEvent(e,function(){g.log("iframe loaded");var b=g._getIframeContentJSON(e);g._options.onComplete(a,d,b),g._dequeue(a),delete g._inputs[a],setTimeout(function(){g._detach_event(),qq.remove(e)},1)}),f.submit(),qq.remove(f),a},_attachLoadEvent:function(a,b){this._detach_event=qq.attach(a,"load",function(){a.parentNode&&(a.contentDocument&&a.contentDocument.body&&"false"==a.contentDocument.body.innerHTML||b())})},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response,innerHTML=doc.body.innerHTML;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+innerHTML),"<pre>"==innerHTML.slice(0,5).toLowerCase()&&"</pre>"==innerHTML.slice(-6).toLowerCase()&&(innerHTML=doc.body.firstChild.firstChild.nodeValue);try{response=eval("("+innerHTML+")")}catch(err){response={}}return response},_createIframe:function(a){var b=qq.toElement('<iframe src="javascript:false;" name="'+a+'" />');return b.setAttribute("id",a),b.style.display="none",document.body.appendChild(b),b},_createForm:function(a,b){var c=qq.toElement('<form method="post" enctype="multipart/form-data"></form>'),d=qq.obj2url(b,this._options.action);return c.setAttribute("action",d),c.setAttribute("target",a.name),c.style.display="none",document.body.appendChild(c),c}}),qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");return a.type="file","multiple"in a&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload},qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File))throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(a)-1},getName:function(a){var b=this._files[a];return null!==b.fileName&&void 0!==b.fileName?b.fileName:b.name},getSize:function(a){var b=this._files[a];return null!=b.fileSize?b.fileSize:b.size},getLoaded:function(a){return this._loaded[a]||0},_upload:function(a,b){this._options.onUpload(a,this.getName(a),!0);var c=this._files[a],d=this.getName(a);this.getSize(a);this._loaded[a]=0;var e=this._xhrs[a]=new XMLHttpRequest,f=this;e.upload.onprogress=function(b){b.lengthComputable&&(f._loaded[a]=b.loaded,f._options.onProgress(a,d,b.loaded,b.total))},e.onreadystatechange=function(){4==e.readyState&&f._onComplete(a,e)},b=b||{},b[this._options.inputName]=d;var g=qq.obj2url(b,this._options.action);if(e.open("POST",g,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("X-File-Name",encodeURIComponent(d)),"multipart"==this._options.encoding){var h=new FormData;h.append(d,c),c=h}else e.setRequestHeader("Content-Type","application/octet-stream"),e.setRequestHeader("X-Mime-Type",c.type);for(var i in this._options.customHeaders)e.setRequestHeader(i,this._options.customHeaders[i]);e.send(c)},_onComplete:function(id,xhr){if(this._files[id]){var name=this.getName(id),size=this.getSize(id);if(this._options.onProgress(id,name,size,size),200==xhr.status){this.log("xhr - server response received"),this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._options.onComplete(id,name,response)}else this._options.onError(id,name,xhr),this._options.onComplete(id,name,{});this._files[id]=null,this._xhrs[id]=null,this._dequeue(id)}},_cancel:function(a){this._options.onCancel(a,this.getName(a)),this._files[a]=null,this._xhrs[a]&&(this._xhrs[a].abort(),this._xhrs[a]=null)}}),qq.DisposeSupport={_disposers:[],dispose:function(){for(var a;a=this._disposers.shift();)a()},addDisposer:function(a){this._disposers.push(a)},_attach:function(){this.addDisposer(qq.attach.apply(this,arguments))}};